acs_save_undo_0_filters = {
    acs_set_new_empty_object = { OBJECT_NAME = new_undo }
    acs_set_copy_save_slots = { FROM = global_var:acs_gv_main_filters TO = scope:new_undo }
    scope:new_undo = {
        if = {
            limit = {
                has_global_variable = asc_gv_undo_first
            }
            set_variable = { name = acs_v_next value = global_var:asc_gv_undo_first }
            global_var:asc_gv_undo_first = {
                set_variable = { name = acs_v_prev value = scope:new_undo }
            }
        }
        else = {
            set_global_variable = { name = asc_gv_undo_last value = scope:new_undo}
        }
        set_global_variable = { name = asc_gv_undo_first value = scope:new_undo }
        if = {
            limit = { has_global_variable = acs_gv_undo_count }
            change_global_variable = { name = acs_gv_undo_count add = 1 } 
        }
        else = {
            set_global_variable = { name = acs_gv_undo_count value = 1 }
        }
        while = {
            limit = {
                global_var:acs_gv_undo_count > 50
            }
            global_var:asc_gv_undo_last = { 
                save_scope_as = to_remove
                var:acs_v_prev = { 
                    save_scope_as = prev_slot 
                    remove_variable = acs_v_next
                }
            }
            set_global_variable = { name = asc_gv_undo_last value = scope:prev_slot }
            acs_set_clear_undo_slot = { SLOT = scope:to_remove }
            acs_set_delete_empty_object = {OBJECT_NAME = scope:to_remove }
            change_global_variable = { name = acs_gv_undo_count add = -1 } 
        }
        
    }
    
    set_global_variable = asc_save_slot_undo_0_used
}

acs_set_clear_undo_slot = {
    $SLOT$ = {
        if = {
            limit = { has_variable = acs_v_filter_relation }
            remove_variable = acs_v_filter_relation
        }
        if = {
            limit = { has_variable_list = acs_vl_filter_trait_education_general }
            clear_variable_list = acs_vl_filter_trait_education_general
        }
        if = {
            limit = { has_variable_list = acs_vl_filter_trait_education_martial }
            clear_variable_list = acs_vl_filter_trait_education_martial
        }
        if = {
            limit = { has_variable_list = acs_vl_filter_trait_fame_born_status }
            clear_variable_list = acs_vl_filter_trait_fame_born_status
        }
        if = {
            limit = { has_variable_list = acs_vl_filter_trait_physical_beauty }
            clear_variable_list = acs_vl_filter_trait_physical_beauty
        }
        if = {
            limit = { has_variable_list = acs_vl_filter_trait_physical_intellect }
            clear_variable_list = acs_vl_filter_trait_physical_intellect
        }
        if = {
            limit = { has_variable_list = acs_vl_filter_trait_physical_physique }
            clear_variable_list = acs_vl_filter_trait_physical_physique
        }
        if = {
            limit = { has_variable_list = acs_vl_filter_active }
            clear_variable_list = acs_vl_filter_active
        }

        if = {
            limit = {
                has_variable = acs_v_prev
            }
            remove_variable = acs_v_prev
        }
        if = {
            limit = {
                has_variable = acs_v_next
            }
            remove_variable = acs_v_next
        }
    }
}

acs_load_undo_0_filters = {
    if = {
        limit = {
            global_var:acs_gv_undo_count > 0
        }
        global_var:asc_gv_undo_first = { 
            save_scope_as = used_slot
            if = {
                limit = { has_variable = acs_v_next }
                var:acs_v_next = {
                    save_scope_as = next_scope
                    set_global_variable = { name = asc_gv_undo_first value = scope:next_scope }
                    remove_variable = acs_v_prev
                }
            }
            else = {
                remove_global_variable = asc_gv_undo_first
                remove_global_variable = asc_gv_undo_last
                remove_global_variable = asc_save_slot_undo_0_used
            }
        }
        acs_set_copy_save_slots = { FROM = scope:used_slot TO = global_var:acs_gv_main_filters }
        acs_set_clear_undo_slot = { SLOT = scope:used_slot }
        acs_set_delete_empty_object = {OBJECT_NAME = scope:used_slot }
        change_global_variable = { name = acs_gv_undo_count add = -1 }
        acs_se_auto_apply_sorting_and_filters = yes
    }
   
}