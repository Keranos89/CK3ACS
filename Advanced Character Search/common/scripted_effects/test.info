acs_set_togle_religion_family_selection = { FAMILY = pagan }

set_variable = { name = test value = global_var:acs_gv_rf_pagan_selected }

global_var:asc_gv_undo_first = { 
	save_scope_as = used_slot
	if = {
		limit = { has_variable = acs_v_next }
		var:acs_v_next = {
			save_scope_as = next_scope
			set_global_variable = { name = asc_gv_undo_first value = scope:next_scope }
			remove_variable = acs_v_prev
		}
	}
	else = {
		remove_global_variable = asc_gv_undo_first
		remove_global_variable = asc_gv_undo_last
		remove_global_variable = asc_save_slot_undo_0_used
	}
}
scope:used_slot = {
	set_global_variable = { name = acs_filter_relation value = var:acs_filter_relation }
	clear_global_variable_list = acs_filter_trait_education_general_list
	if = {
		limit = { has_variable_list = acs_vl_filter_trait_education_general }
		every_in_list = {
			variable = acs_vl_filter_trait_education_general
			save_temporary_scope_as = slot_value
			add_to_global_variable_list = { name = acs_filter_trait_education_general_list target = scope:slot_value }
		}
	}
	clear_global_variable_list = acs_filter_trait_education_martial_list
	if = {
		limit = { has_variable_list = acs_vl_filter_trait_education_martial }
		every_in_list = {
			variable = acs_vl_filter_trait_education_martial
			save_temporary_scope_as = slot_value
			add_to_global_variable_list = { name = acs_filter_trait_education_martial_list target = scope:slot_value }
		}
	}
	clear_global_variable_list = acs_filter_trait_fame_born_status_list
	if = {
		limit = { has_variable_list = acs_vl_filter_trait_fame_born_status }
		every_in_list = {
			variable = acs_vl_filter_trait_fame_born_status
			save_temporary_scope_as = slot_value
			add_to_global_variable_list = { name = acs_filter_trait_fame_born_status_list target = scope:slot_value }
		}
	}

	clear_global_variable_list = acs_filter_trait_physical_beauty_list
	if = {
		limit = { has_variable_list = acs_vl_filter_trait_physical_beauty }
		every_in_list = {
			variable = acs_vl_filter_trait_physical_beauty
			save_temporary_scope_as = slot_value
			add_to_global_variable_list = { name = acs_filter_trait_physical_beauty_list target = scope:slot_value }
		}
	}

	clear_global_variable_list = acs_filter_trait_physical_intellect_list
	if = {
		limit = { has_variable_list = acs_vl_filter_trait_physical_intellect }
		every_in_list = {
			variable = acs_vl_filter_trait_physical_intellect
			save_temporary_scope_as = slot_value
			add_to_global_variable_list = { name = acs_filter_trait_physical_intellect_list target = scope:slot_value }
		}
	}

	clear_global_variable_list = acs_filter_trait_physical_physique_list
	if = {
		limit = { has_variable_list = acs_vl_filter_trait_physical_physique }
		every_in_list = {
			variable = acs_vl_filter_trait_physical_physique
			save_temporary_scope_as = slot_value
			add_to_global_variable_list = { name = acs_filter_trait_physical_physique_list target = scope:slot_value }
		}
	}
	
	every_in_list = acs_vl_filter_active
	if = {
		limit = { has_variable_list = acs_vl_filter_active }
		every_in_list = {
			variable = acs_vl_filter_active
			save_temporary_scope_as = slot_value
			add_to_global_variable_list = { name = acs_vl_filter_active target = scope:slot_value }
		}
	}
	
}

acs_se_save_undo = {
    acs_set_new_empty_object = { OBJECT_NAME = new_undo }
    scope:new_undo = {
        set_variable = { name = acs_v_filter_relation value = global_var:acs_gv_main_filters.var:acs_v_filter_relation }
        every_in_global_list = {
            variable = acs_filter_trait_education_general_list
            save_temporary_scope_as = slot_value
            scope:new_undo = {
                add_to_variable_list = { name = acs_vl_filter_trait_education_general target = scope:slot_value } 
            }  
        }
        every_in_global_list = {
            variable = acs_filter_trait_education_martial_list
            save_temporary_scope_as = slot_value
            scope:new_undo = {
                add_to_variable_list = { name = acs_vl_filter_trait_education_martial target = scope:slot_value } 
            }  
        }
        every_in_global_list = {
            variable = acs_filter_trait_fame_born_status_list
            save_temporary_scope_as = slot_value
            scope:new_undo = {
                add_to_variable_list = { name = acs_vl_filter_trait_fame_born_status target = scope:slot_value } 
            }  
        }
        every_in_global_list = {
            variable = acs_filter_trait_physical_beauty_list
            save_temporary_scope_as = slot_value
            scope:new_undo = {
                add_to_variable_list = { name = acs_vl_filter_trait_physical_beauty target = scope:slot_value } 
            }  
        }
        every_in_global_list = {
            variable = acs_filter_trait_physical_intellect_list
            save_temporary_scope_as = slot_value
            scope:new_undo = {
                add_to_variable_list = { name = acs_vl_filter_trait_physical_intellect target = scope:slot_value } 
            }  
        }
        every_in_global_list = {
            variable = acs_filter_trait_physical_physique_list
            save_temporary_scope_as = slot_value
            scope:new_undo = {
                add_to_variable_list = { name = acs_vl_filter_trait_physical_physique target = scope:slot_value } 
            }  
        }
        every_in_global_list = {
            variable = acs_vl_filter_active
            save_temporary_scope_as = slot_value
            scope:new_undo = {
                add_to_variable_list = { name = acs_vl_filter_active target = scope:slot_value } 
            }  
        }
        if = {
            limit = {
                has_global_variable = asc_gv_undo_first
            }
            set_variable = { name = acs_v_next value = global_var:asc_gv_undo_first }
            global_var:asc_gv_undo_first = {
                set_variable = { name = acs_v_prev value = scope:new_undo }
            }
        }
        else = {
            set_global_variable = { name = asc_gv_undo_last value = scope:new_undo}
        }
        set_global_variable = { name = asc_gv_undo_first value = scope:new_undo }
        if = {
            limit = { has_global_variable = acs_gv_undo_count }
            change_global_variable = { name = acs_gv_undo_count add = 1 } 
        }
        else = {
            set_global_variable = { name = acs_gv_undo_count value = 1 }
        }
        while = {
            limit = {
                global_var:acs_gv_undo_count > 50
            }
            global_var:asc_gv_undo_last = { 
                save_scope_as = to_remove
                var:acs_v_prev = { 
                    save_scope_as = prev_slot 
                    remove_variable = acs_v_next
                }
            }
            set_global_variable = { name = asc_gv_undo_last value = scope:prev_slot }
            acs_set_clear_undo_slot = { SLOT = scope:to_remove }
            acs_set_delete_empty_object = {OBJECT_NAME = scope:to_remove }
            change_global_variable = { name = acs_gv_undo_count add = -1 } 
        }
        
    }
    
    set_global_variable = asc_save_slot_undo_0_used
}




global_var:asc_gv_undo_first = { 
	save_scope_as = used_slot
}

set_variable = { name = test value = scope:used_slot.var:acs_filter_relation }

global_var:asc_gv_undo_first = { 
	save_scope_as = used_slot
	has_variable = acs_filter_relation
}

acs_set_new_empty_object = { OBJECT_NAME = new_undo }
set_global_variable = { name = acs_filter_relation value = 15 }
scope:new_undo = {
	set_variable = { name = acs_v_filter_relation value = global_var:acs_gv_main_filters.var:acs_v_filter_relation }
}
set_variable = { name = acs_v_filter_relation value = global_var:acs_gv_main_filters.var:acs_v_filter_relation }
set_variable = { name = acs_v_filter_relation_new value = scope:new_undo.var:acs_v_filter_relation }


set_variable = { name = acs_v_filter_relation_new value = scope:used_slot.var:acs_v_filter_relation }



global_var:acs_gv_main_filters = {
    has_variable = 
}

has_global_variable = acs_gv_main_filters
save_scope_as = help
acs_set_copy_save_slots = { FROM = global_var:acs_gv_main_filters TO = scope:help }
global_var:acs_gv_main_filters = {
    var:acs_v_filter_relation = { 
        save_scope_as = temp
    }
}
global_var:acs_gv_main_filters = {
    set_variable = {name = acs_v_filter_relation value = 4 }
}
global_var:acs_gv_main_filters = {
    has_variable = acs_v_filter_relation
}
scope:help = { 
    set_variable = { 
        name = acs_v_filter_relation
        value = scope:temp
    } 
}

set_variable = { 
    name = acs_v_filter_relation
    value =  global_var:acs_gv_main_filters.var:acs_v_filter_relation
} 

4 = { save_scope_as = ctrl_value }
acs_filter_relation = {
    saved_scopes = {
        ctrl_value
    }
    is_shown = {
        global_var:acs_gv_main_filters.var:acs_v_filter_relation = scope:ctrl_value
    }
        
    effect = {
        acs_se_save_undo = yes
        global_var:acs_gv_main_filters = {
            set_variable = {  name = acs_v_filter_relation value = scope:ctrl_value }
        }
        
        acs_se_auto_apply_sorting_and_filters = yes
    }
}
global_var:acs_gv_main_filters = {
    acs_set_copy_list = { TO = scope:help LIST_NAME = acs_vl_filter_active }
}

global_var:acs_gv_main_filters = {
    scope:help = { clear_variable_list = acs_vl_filter_active }
    every_in_list = {
        variable = acs_vl_filter_active
        save_temporary_scope_as = slot_value
        scope:help = {
            add_to_variable_list = { name = acs_vl_filter_active target = scope:slot_value } 
        }  
    }
}
global_var:acs_gv_main_filters = {
    has_variable_list = acs_vl_filter_active
}
acs_set_copy_save_slots = { # FROM : scope, TO : scope
    $FROM$ = {
        if = {
            limit = { has_variable = acs_v_filter_relation }
            $TO$ = { set_variable = { name = acs_v_filter_relation value = $FROM$.var:acs_v_filter_relation } }
        }
        acs_set_copy_list = { TO = $TO$ LIST_NAME = acs_vl_filter_trait_education_general }
        acs_set_copy_list = { TO = $TO$ LIST_NAME = acs_vl_filter_trait_education_martial }
        acs_set_copy_list = { TO = $TO$ LIST_NAME = acs_vl_filter_trait_fame_born_status }
        acs_set_copy_list = { TO = $TO$ LIST_NAME = acs_vl_filter_trait_physical_beauty }
        acs_set_copy_list = { TO = $TO$ LIST_NAME = acs_vl_filter_trait_physical_intellect }
        acs_set_copy_list = { TO = $TO$ LIST_NAME = acs_vl_filter_trait_physical_physique }
        acs_set_copy_list = { TO = $TO$ LIST_NAME = acs_vl_filter_active }
    } 
}

save_temporary_scope_as = candidate
global_var:acs_gv_main_filters = {
    any_in_list = {
        variable = acs_vl_filter_active
        save_temporary_scope_as = tag
        acs_switch_filter = { FILTER = scope:tag CANDIDATE = scope:candidate }
        count = all
    }
}

any_in_global_list = {
    variable = acs_gvl_save_slot
    var:acs_v_index = 0
    has_variable = acs_v_is_used
}


acs_set_clear_save_slot = {  SLOT = $SLOT$ }
acs_set_save_filters = { SLOT = 0 }


acs_st_find_save_slot = { SLOT = 0 RESULT = to_save }
scope:to_save = {
    if = {
        limit = {
            NOT = { acs_stt_is_slot_default = {  SLOT = global_var:acs_gv_main_filters } }
        }
        acs_set_copy_save_slots = { FROM = global_var:acs_gv_main_filters TO = scope:to_save }
        set_variable = acs_v_is_used
    }
    else = {
        remove_variable = acs_v_is_used
    }
}
acs_st_find_save_slot = { SLOT = 0 RESULT = to_load }


save_scope_as = help

acs_set_copy_from_all_rf_to_save_slot = {SLOT = scope:help }

global_var:acs_gv_main_filters = {
    trigger_if = {
        limit = { has_variable = acs_v_rf_abrahamic_selected	}
        var:acs_v_rf_abrahamic_selected = 3
    }
    trigger_else ={ always = no	}
}
save_temporary_scope_as = acs_ts_faith_to_update
acs_set_copy_from_religion_to_save_slot = {  }

every_faith = {
    save_temporary_scope_as = acs_ts_faith_to_update
    acs_set_copy_from_faith_to_save_slot = { FAITH = scope:acs_ts_faith_to_update SLOT_FAITH = global_var:acs_gv_main_filters }
}

save_temporary_scope_as = acs_ts_religion_to_update
acs_set_copy_from_religion_to_save_slot = { RELIGION = scope:acs_ts_religion_to_update SLOT_RELIGION = global_var:acs_gv_main_filters }

save_temporary_scope_as = acs_ts_faith
if = {
    limit = { NOT = { has_variable = acs_v_selected } }
    $SLOT_FAITH$ = {
        remove_list_variable = { name = acs_vl_has_faith target = scope:acs_ts_faith }
        remove_list_variable = { name = acs_vl_dont_have_faith target = scope:acs_ts_faith }
    }	
}
save_temporary_scope_as = help
global_var:acs_gv_main_filters = {
    any_in_list = {
        variable = acs_vl_religion_filter
        save_temporary_scope_as = filter2
        scope:help = {
            switch = {
                trigger = scope:filter2
                0 = {
                    religion = { is_in_family = rf_pagan }
                }
                1 = {
                    NOT = { religion = { is_in_family = rf_pagan } }
                }
                2 = {
                    religion = { is_in_family = rf_eastern }
                }
                3 = {
                    NOT = { religion = { is_in_family = rf_eastern } }
                }
                4 = {
                    religion = { is_in_family = rf_abrahamic }
                }
                5 = {
                    NOT = { religion = { is_in_family = rf_abrahamic } }
                }
                6 = {
                    NOR = {
                        religion = { is_in_family = rf_pagan }
                        religion = { is_in_family = rf_eastern }
                        religion = { is_in_family = rf_abrahamic }
                    }
                }
                7 = { 
                    AND = {
                        religion = { is_in_family = rf_pagan }
                        religion = { is_in_family = rf_eastern }
                        religion = { is_in_family = rf_abrahamic }
                    }    
                }
                8 = {
                    faith = { 
                        save_temporary_scope_as = acs_ts_faith
                        any_in_list = { variable = acs_vl_has_faith this = scope:acs_ts_faith count > 0 }
                    }
                }
                9 = {
                    religion = { 
                        save_temporary_scope_as = acs_ts_religion
                        any_in_list = { variable = acs_vl_has_religion this = scope:acs_ts_religion count > 0 }
                    }
                }
                10 = {
                    faith = { 
                        save_temporary_scope_as = acs_ts_faith
                        any_in_list = { variable = acs_vl_dont_have_faith this = scope:acs_ts_faith count = 0 }
                    }
                }
                11 = {
                    religion = { 
                        save_temporary_scope_as = acs_ts_religion
                        any_in_list = { variable = acs_vl_dont_have_religion this = scope:acs_ts_religion count = 0 }
                    }
                }
            }
        }
        count = global_var:acs_gv_main_filters.var:acs_v_religion_filter_count
    }
}


trigger_if = {
    limit = { NOT = { has_variable = acs_v_rf_pagan_selected } }
    global_var:acs_gv_main_filters = { NOT = { has_variable = acs_v_rf_pagan_selected } }
}
trigger_else_if = {
    limit = { global_var:acs_gv_main_filters = { NOT = { has_variable = acs_v_rf_pagan_selected } } }
    always = no
}
trigger_else = {
    var:acs_v_rf_pagan_selected = global_var:acs_gv_main_filters.var:acs_v_rf_pagan_selected
}
save_temporary_scope_as = acs_ts_faith
global_var:acs_gv_main_filters = { 
    remove_list_variable = { name = acs_vl_dont_have_faith target = scope:acs_ts_faith }
    add_to_variable_list = { name = acs_vl_has_faith target = scope:acs_ts_faith }
}
acs_set_copy_save_slots = { FROM = scope:to_load TO = scope:help }

set_variable = { name = is_used value = scope:to_load.var:acs_v_is_used }

acs_current_slot_used = {
    value = -1
    if = {
        limit = {
            acs_stt_is_slot_default = { SLOT = global_var:acs_gv_main_filters }
        }
        add = -1
    }
  
    else_if = {
        ordered_child = {
            order_by = var:acs_v_index
            max = 1
            limit = { 
                has_variable = acs_v_is_used
                save_temporary_scope_as = temp_scope
                acs_stt_equal_slots = { SLOT1 = global_var:acs_gv_main_filters SLOT2 = scope:temp_scope }
            }
            add = var:acs_v_index
            add = 1
        }
    }
}
ordered_child = {
    order_by = var:acs_v_index
    max = 13
    save_scope_as = temp_scope
    limit = { 
        has_variable = acs_v_is_used
        
        acs_stt_equal_slots = { SLOT1 = global_var:acs_gv_main_filters SLOT2 = scope:temp_scope }
    }
}

